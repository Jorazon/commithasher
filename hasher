#!/bin/bash

TARGET="000" # The target pattern (3 leading zeros)
MESSAGE=$(git log -1 --pretty=format:"%s") # original commit message
COUNT=1

# ASCII characters set: 0-9, A-F
CHARS=({0..9} {A..F})

# Function to generate random trailing data
generate_trailing_data() {
  TRAILING=""
  for i in {1..6}; do  # Length of trailing data, adjust as needed
    TRAILING+="${CHARS[RANDOM % ${#CHARS[@]}]}"
  done
  echo "$TRAILING"
}

# Setup for braille status indicator
braille_chars=("⠇" "⠋" "⠙" "⠸" "⠴" "⠦")
i=0

echo -ne "  Finding a cool hash for you\r"

while true; do
  # Update status indicator
  echo -ne "${braille_chars[$((i % ${#braille_chars[@]}))]}\r"
  ((i++))

  # Generate trailing characters
  TRAILING_DATA=$(generate_trailing_data)

  # New commit message
  NEW_MESSAGE="$MESSAGE #$TRAILING_DATA"

  # Amend commit
  git commit --amend -m "$NEW_MESSAGE" --no-edit > /dev/null 2>&1

  # Get short hash of modified commit
  HASH=$(git log -1 --pretty=format:"%h")

  # Check if the hash matches the required pattern
  if [[ "$HASH" == $TARGET* ]]; then
    echo "Found matching hash: $HASH"
    echo "Amending commit with #$TRAILING_DATA"
    break
  fi
done
